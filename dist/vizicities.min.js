!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("proj4"),require("THREE")):"function"==typeof define&&define.amd?define(["proj4","THREE"],t):"object"==typeof exports?exports.VIZI=t(require("proj4"),require("THREE")):e.VIZI=t(e.proj4,e.THREE)}(this,function(e,t){return function(e){function __webpack_require__(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}var t={};return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.p="",__webpack_require__(0)}([function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=_interopRequireDefault(r),i=n(28),a=_interopRequireDefault(i),u=n(31),s=_interopRequireDefault(u),l=n(33),c=_interopRequireDefault(l),f=n(11),d=_interopRequireDefault(f),h=n(10),p=_interopRequireDefault(h),v={version:"0.3",World:o["default"],Controls:a["default"],EnvironmentLayer:s["default"],GridLayer:c["default"],Point:d["default"],LatLon:p["default"]};t["default"]=v,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;if(void 0===s)return;return s.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,u=l=void 0}},i=n(2),a=_interopRequireDefault(i),u=n(3),s=_interopRequireDefault(u),l=n(6),c=_interopRequireDefault(l),f=n(11),d=_interopRequireDefault(f),h=n(10),p=_interopRequireDefault(h),v=n(23),_=_interopRequireDefault(v),m=function(e){function World(e,t){_classCallCheck(this,World),o(Object.getPrototypeOf(World.prototype),"constructor",this).call(this);var n={crs:c["default"].EPSG3857};this.options=(0,s["default"])(n,t),this._layers=[],this._controls=[],this._initContainer(e),this._initEngine(),this._initEvents(),this._update()}return _inherits(World,e),r(World,[{key:"_initContainer",value:function(e){this._container=document.getElementById(e)}},{key:"_initEngine",value:function(){this._engine=(0,_["default"])(this._container)}},{key:"_initEvents",value:function(){this.on("controlsMoveEnd",this._onControlsMoveEnd)}},{key:"_onControlsMoveEnd",value:function(e){var t=(0,d["default"])(e.x,e.z);this._resetView(this.pointToLatLon(t))}},{key:"_resetView",value:function(e){this.emit("preResetView"),this._moveStart(),this._move(e),this._moveEnd(),this.emit("postResetView")}},{key:"_moveStart",value:function(){this.emit("moveStart")}},{key:"_move",value:function(e){this._lastPosition=e,this.emit("move",e)}},{key:"_moveEnd",value:function(){this.emit("moveEnd")}},{key:"_update",value:function(){var e=this._engine.clock.getDelta();window.requestAnimationFrame(this._update.bind(this)),this._controls.forEach(function(e){e.update()}),this.emit("preUpdate"),this._engine.update(e),this.emit("postUpdate")}},{key:"setView",value:function(e){return this._originLatlon=e,this._originPoint=this.project(e),this._resetView(e),this}},{key:"getPosition",value:function(){return this._lastPosition}},{key:"project",value:function(e){return this.options.crs.latLonToPoint((0,p["default"])(e))}},{key:"unproject",value:function(e){return this.options.crs.pointToLatLon((0,d["default"])(e))}},{key:"latLonToPoint",value:function(e){var t=this.project((0,p["default"])(e));return t._subtract(this._originPoint)}},{key:"pointToLatLon",value:function(e){var t=(0,d["default"])(e).add(this._originPoint);return this.unproject(t)}},{key:"getCamera",value:function(){return this._engine._camera}},{key:"addLayer",value:function(e){return e._addToWorld(this),this._layers.push(e),this._engine._scene.add(e._layer),this.emit("layerAdded",e),this}},{key:"removeLayer",value:function(e){}},{key:"addControls",value:function(e){return e._addToWorld(this),this._controls.push(e),this.emit("controlsAdded",e),this}},{key:"removeControls",value:function(e){}}]),World}(a["default"]);t["default"]=function(e,t){return new m(e,t)},e.exports=t["default"]},function(e,t,n){"use strict";function EE(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function EventEmitter(){}var r="function"!=typeof Object.create?"~":!1;EventEmitter.prototype._events=void 0,EventEmitter.prototype.listeners=function(e,t){var n=r?r+e:e,o=this._events&&this._events[n];if(t)return!!o;if(!o)return[];if(o.fn)return[o.fn];for(var i=0,a=o.length,u=new Array(a);a>i;i++)u[i]=o[i].fn;return u},EventEmitter.prototype.emit=function(e,t,n,o,i,a){var u=r?r+e:e;if(!this._events||!this._events[u])return!1;var s,l,c=this._events[u],f=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,o),!0;case 5:return c.fn.call(c.context,t,n,o,i),!0;case 6:return c.fn.call(c.context,t,n,o,i,a),!0}for(l=1,s=new Array(f-1);f>l;l++)s[l-1]=arguments[l];c.fn.apply(c.context,s)}else{var d,h=c.length;for(l=0;h>l;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;default:if(!s)for(d=1,s=new Array(f-1);f>d;d++)s[d-1]=arguments[d];c[l].fn.apply(c[l].context,s)}}return!0},EventEmitter.prototype.on=function(e,t,n){var o=new EE(t,n||this),i=r?r+e:e;return this._events||(this._events=r?{}:Object.create(null)),this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):this._events[i]=o,this},EventEmitter.prototype.once=function(e,t,n){var o=new EE(t,n||this,!0),i=r?r+e:e;return this._events||(this._events=r?{}:Object.create(null)),this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):this._events[i]=o,this},EventEmitter.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events||!this._events[i])return this;var a=this._events[i],u=[];if(t)if(a.fn)(a.fn!==t||o&&!a.once||n&&a.context!==n)&&u.push(a);else for(var s=0,l=a.length;l>s;s++)(a[s].fn!==t||o&&!a[s].once||n&&a[s].context!==n)&&u.push(a[s]);return u.length?this._events[i]=1===u.length?u[0]:u:delete this._events[i],this},EventEmitter.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[r?r+e:e]:this._events=r?{}:Object.create(null),this):this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.prefixed=r,e.exports=EventEmitter},function(e,t,n){function isIndex(e,t){return e="number"==typeof e||s.test(e)?+e:-1,t=null==t?i:t,e>-1&&e%1==0&&t>e}function assignValue(e,t,n){var r=e[t];(!eq(r,n)||eq(r,l[t])&&!c.call(e,t)||void 0===n&&!(t in e))&&(e[t]=n)}function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function copyObject(e,t,n){return copyObjectWith(e,t,n)}function copyObjectWith(e,t,n,r){n||(n={});for(var o=-1,i=t.length;++o<i;){var a=t[o],u=r?r(n[a],e[a],a,n,e):e[a];assignValue(n,a,u)}return n}function createAssigner(e){return o(function(t,n){var r=-1,o=n.length,i=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(i="function"==typeof i?(o--,i):void 0,a&&isIterateeCall(n[0],n[1],a)&&(i=3>o?void 0:i,o=1),t=Object(t);++r<o;){var u=n[r];u&&e(t,u,r,i)}return t})}function isIterateeCall(e,t,n){if(!isObject(n))return!1;var r=typeof t;return("number"==r?isArrayLike(n)&&isIndex(t,n.length):"string"==r&&t in n)?eq(n[t],e):!1}function eq(e,t){return e===t||e!==e&&t!==t}function isArrayLike(e){return null!=e&&!("function"==typeof e&&isFunction(e))&&isLength(d(e))}function isFunction(e){var t=isObject(e)?f.call(e):"";return t==a||t==u}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&i>=e}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var r=n(4),o=n(5),i=9007199254740991,a="[object Function]",u="[object GeneratorFunction]",s=/^(?:0|[1-9]\d*)$/,l=Object.prototype,c=l.hasOwnProperty,f=l.toString,d=baseProperty("length"),h=createAssigner(function(e,t){copyObject(t,r(t),e)});e.exports=h},function(e,t){function baseTimes(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function isIndex(e,t){return e="number"==typeof e||u.test(e)?+e:-1,t=null==t?n:t,e>-1&&e%1==0&&t>e}function baseHas(e,t){return l.call(e,t)||"object"==typeof e&&t in e&&null===f(e)}function baseKeys(e){return h(Object(e))}function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function indexKeys(e){var t=e?e.length:void 0;return isLength(t)&&(v(e)||isString(e)||isArguments(e))?baseTimes(t,String):null}function isPrototype(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||s;return e===n}function isArguments(e){return isArrayLikeObject(e)&&l.call(e,"callee")&&(!d.call(e,"callee")||c.call(e)==r)}function isArrayLike(e){return null!=e&&!("function"==typeof e&&isFunction(e))&&isLength(p(e))}function isArrayLikeObject(e){return isObjectLike(e)&&isArrayLike(e)}function isFunction(e){var t=isObject(e)?c.call(e):"";return t==o||t==i}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&n>=e}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==typeof e}function isString(e){return"string"==typeof e||!v(e)&&isObjectLike(e)&&c.call(e)==a}function keys(e){var t=isPrototype(e);if(!t&&!isArrayLike(e))return baseKeys(e);var n=indexKeys(e),r=!!n,o=n||[],i=o.length;for(var a in e)!baseHas(e,a)||r&&("length"==a||isIndex(a,i))||t&&"constructor"==a||o.push(a);return o}var n=9007199254740991,r="[object Arguments]",o="[object Function]",i="[object GeneratorFunction]",a="[object String]",u=/^(?:0|[1-9]\d*)$/,s=Object.prototype,l=s.hasOwnProperty,c=s.toString,f=Object.getPrototypeOf,d=s.propertyIsEnumerable,h=Object.keys,p=baseProperty("length"),v=Array.isArray;e.exports=keys},function(e,t){function apply(e,t,n){var r=n.length;switch(r){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function rest(e,t){if("function"!=typeof e)throw new TypeError(n);return t=v(void 0===t?e.length-1:toInteger(t),0),function(){for(var n=arguments,r=-1,o=v(n.length-t,0),i=Array(o);++r<o;)i[r]=n[t+r];switch(t){case 0:return e.call(this,i);case 1:return e.call(this,n[0],i);case 2:return e.call(this,n[0],n[1],i)}var a=Array(t+1);for(r=-1;++r<t;)a[r]=n[r];return a[t]=i,apply(e,this,a)}}function isFunction(e){var t=isObject(e)?p.call(e):"";return t==a||t==u}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function toInteger(e){if(!e)return 0===e?e:0;if(e=toNumber(e),e===r||e===-r){var t=0>e?-1:1;return t*o}var n=e%1;return e===e?n?e-n:e:0}function toNumber(e){if(isObject(e)){var t=isFunction(e.valueOf)?e.valueOf():e;e=isObject(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var n=c.test(e);return n||f.test(e)?d(e.slice(2),n?2:8):l.test(e)?i:+e}var n="Expected a function",r=1/0,o=1.7976931348623157e308,i=NaN,a="[object Function]",u="[object GeneratorFunction]",s=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,f=/^0o[0-7]+$/i,d=parseInt,h=Object.prototype,p=h.toString,v=Math.max;e.exports=rest},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=_interopRequireDefault(r),i=n(15),a=_interopRequireDefault(i),u=n(17),s=_interopRequireDefault(u),l=n(19),c=_interopRequireDefault(l),f=n(20),d=_interopRequireDefault(f),h={};h.EPSG3857=o["default"],h.EPSG900913=r.EPSG900913,h.EPSG3395=a["default"],h.EPSG4326=s["default"],h.Simple=c["default"],h.Proj4=d["default"],t["default"]=h,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=_interopRequireDefault(r),i=n(8),a=_interopRequireDefault(i),u=n(13),s=_interopRequireDefault(u),l=n(14),c=_interopRequireDefault(l),f={code:"EPSG:3857",projection:s["default"],transformScale:1/(Math.PI*s["default"].R),transformation:function(){var e=1/(Math.PI*s["default"].R);return new c["default"](e,0,-e,0)}()},d=(0,o["default"])({},a["default"],f),h=(0,o["default"])({},d,{code:"EPSG:900913"});t.EPSG900913=h,t["default"]=d},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=_interopRequireDefault(r),i=n(9),a=_interopRequireDefault(i),u=n(10),s=(_interopRequireDefault(u),{wrapLon:[-180,180],R:6378137,distance:function(e,t,n){var r,o,i,a=Math.PI/180;if(n){r=e.lat*a,o=t.lat*a;var u=e.lon*a,s=t.lon*a,l=o-r,c=s-u,f=l/2,d=c/2;i=Math.sin(f)*Math.sin(f)+Math.cos(r)*Math.cos(o)*Math.sin(d)*Math.sin(d);var h=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i));return this.R*h}return r=e.lat*a,o=t.lat*a,i=Math.sin(r)*Math.sin(o)+Math.cos(r)*Math.cos(o)*Math.cos((t.lon-e.lon)*a),this.R*Math.acos(Math.min(i,1))},pointScale:function(e,t){return this.projection.pointScale?this.projection.pointScale(e,t):[1,1]},metresToProjected:function(e,t){return e*t[1]},projectedToMetres:function(e,t){return e/t[1]},metresToWorld:function(e,t,n){var r=this.metresToProjected(e,t),o=this.scale(n);n&&(o/=2);var i=o*(this.transformScale*r)/t[1];return i},worldToMetres:function(e,t,n){var r=this.scale(n);n&&(r/=2);var o=e/r/this.transformScale*t[1],i=this.projectedToMetres(o,t);return i}});t["default"]=(0,o["default"])({},a["default"],s),e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),o=_interopRequireDefault(r),i=n(11),a=_interopRequireDefault(i),u=n(12),s=_interopRequireDefault(u),l={scaleFactor:1e6,latLonToPoint:function(e,t){var n=this.projection.project(e),r=this.scale(t);return t&&(r/=2),this.transformation._transform(n,r)},pointToLatLon:function(e,t){var n=this.scale(t);t&&(n/=2);var r=this.transformation.untransform(e,n);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return e>=0?256*Math.pow(2,e):this.scaleFactor},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,n=this.scale(e);e&&(n/=2);var r=this.transformation.transform((0,a["default"])(t[0]),n),o=this.transformation.transform((0,a["default"])(t[1]),n);return[r,o]},wrapLatLon:function(e){var t=this.wrapLat?(0,s["default"])(e.lat,this.wrapLat,!0):e.lat,n=this.wrapLon?(0,s["default"])(e.lon,this.wrapLon,!0):e.lon,r=e.alt;return(0,o["default"])(t,n,r)}};t["default"]=l,e.exports=t["default"]},function(e,t){function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),r=function(){function LatLon(e,t,n){if(_classCallCheck(this,LatLon),isNaN(e)||isNaN(t))throw new Error("Invalid LatLon object: ("+e+", "+t+")");this.lat=+e,this.lon=+t,void 0!==n&&(this.alt=+n)}return n(LatLon,[{key:"clone",value:function(){return new LatLon(this.lat,this.lon,this.alt)}}]),LatLon}();t["default"]=function(e,t,n){return e instanceof r?e:Array.isArray(e)&&"object"!=typeof e[0]?3===e.length?new r(e[0],e[1],e[2]):2===e.length?new r(e[0],e[1]):null:void 0===e||null===e?e:"object"==typeof e&&"lat"in e?new r(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new r(e,t,n)},e.exports=t["default"]},function(e,t){function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),r=function(){function Point(e,t,n){_classCallCheck(this,Point),this.x=n?Math.round(e):e,this.y=n?Math.round(t):t}return n(Point,[{key:"clone",value:function(){return new Point(this.x,this.y)}},{key:"add",value:function(e){return this.clone()._add(o(e))}},{key:"_add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"subtract",value:function(e){return this.clone()._subtract(o(e))}},{key:"_subtract",value:function(e){return this.x-=e.x,this.y-=e.y,this}}]),Point}(),o=function(e,t,n){return e instanceof r?e:Array.isArray(e)?new r(e[0],e[1]):void 0===e||null===e?e:new r(e,t,n)};t["default"]=o,e.exports=t["default"]},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,n){var r=t[1],o=t[0],i=r-o;return e===r&&n?e:((e-o)%i+i)%i+o};t["default"]=n,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),o=_interopRequireDefault(r),i=n(11),a=_interopRequireDefault(i),u={R:6378137,MAX_LATITUDE:85.0511287798,ECC:.081819191,ECC2:.006694380015894481,project:function(e){var t=Math.PI/180,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,e.lat),-n),o=Math.sin(r*t);return(0,a["default"])(this.R*e.lon*t,this.R*Math.log((1+o)/(1-o))/2)},unproject:function(e){var t=180/Math.PI;return(0,o["default"])((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},pointScale:function(e,t){var n,r=Math.PI/180;if(t){var o=e.lat*r,i=(e.lon*r,this.R),a=Math.sin(o),u=a*a,s=Math.cos(o),l=i*(1-this.ECC2)/Math.pow(1-this.ECC2*u,1.5),c=i/Math.sqrt(1-this.ECC2*u),f=i/l/s;return n=i/c/s,[n,f]}return n=1/Math.cos(e.lat*r),[n,n]},bounds:function(){var e=6378137*Math.PI;return[[-e,-e],[e,e]]}()};t["default"]=u,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=n(11),i=_interopRequireDefault(o),a=function(){function Transformation(e,t,n,r){_classCallCheck(this,Transformation),this._a=e,this._b=t,this._c=n,this._d=r}return r(Transformation,[{key:"transform",value:function(e,t){return this._transform(e.clone(),t)}},{key:"_transform",value:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e}},{key:"untransform",value:function(e,t){return t=t||1,(0,i["default"])((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}}]),Transformation}();t["default"]=a,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=_interopRequireDefault(r),i=n(8),a=_interopRequireDefault(i),u=n(16),s=_interopRequireDefault(u),l=n(14),c=_interopRequireDefault(l),f={code:"EPSG:3395",projection:s["default"],transformScale:1/(Math.PI*s["default"].R),transformation:function(){var e=1/(Math.PI*s["default"].R);return new c["default"](e,0,-e,0)}()},d=(0,o["default"])({},a["default"],f);t["default"]=d,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),o=_interopRequireDefault(r),i=n(11),a=_interopRequireDefault(i),u={R:6378137,R_MINOR:6356752.314245179,ECC:.081819191,ECC2:.006694380015894481,project:function(e){var t=Math.PI/180,n=this.R,r=e.lat*t,o=this.R_MINOR/n,i=Math.sqrt(1-o*o),u=i*Math.sin(r),s=Math.tan(Math.PI/4-r/2)/Math.pow((1-u)/(1+u),i/2);return r=-n*Math.log(Math.max(s,1e-10)),(0,a["default"])(e.lon*t*n,r)},unproject:function(e){for(var t,n=180/Math.PI,r=this.R,i=this.R_MINOR/r,a=Math.sqrt(1-i*i),u=Math.exp(-e.y/r),s=Math.PI/2-2*Math.atan(u),l=0,c=.1;15>l&&Math.abs(c)>1e-7;l++)t=a*Math.sin(s),t=Math.pow((1-t)/(1+t),a/2),c=Math.PI/2-2*Math.atan(u*t)-s,s+=c;return(0,o["default"])(s*n,e.x*n/r)},pointScale:function(e){var t=Math.PI/180,n=e.lat*t,r=Math.sin(n),o=r*r,i=Math.cos(n),a=Math.sqrt(1-this.ECC2*o)/i;return[a,a]},bounds:[[-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]]};t["default"]=u,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=_interopRequireDefault(r),i=n(8),a=_interopRequireDefault(i),u=n(18),s=_interopRequireDefault(u),l=n(14),c=_interopRequireDefault(l),f={code:"EPSG:4326",projection:s["default"],transformScale:1/180,transformation:new c["default"](1/180,0,-1/180,0)},d=(0,o["default"])({},a["default"],f);t["default"]=d,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),o=_interopRequireDefault(r),i=n(11),a=_interopRequireDefault(i),u={project:function(e){return(0,a["default"])(e.lon,e.lat)},unproject:function(e){return(0,o["default"])(e.y,e.x)},pointScale:function(e){var t=111132.92,n=-559.82,r=1.175,o=-.0023,i=111412.84,a=-93.5,u=.118,s=Math.PI/180,l=e.lat*s,c=t+n*Math.cos(2*l)+r*Math.cos(4*l)+o*Math.cos(6*l),f=i*Math.cos(l)+a*Math.cos(3*l)+u*Math.cos(5*l);return[1/c,1/f]},bounds:[[-180,-90],[180,90]]};t["default"]=u,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=_interopRequireDefault(r),i=n(9),a=_interopRequireDefault(i),u=n(18),s=_interopRequireDefault(u),l=n(14),c=_interopRequireDefault(l),f={projection:s["default"],transformation:new c["default"](1,0,1,0),scale:function(e){return e?Math.pow(2,e):1},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var n=t.lon-e.lon,r=t.lat-e.lat;return Math.sqrt(n*n+r*r)},infinite:!0},d=(0,o["default"])({},a["default"],f);t["default"]=d,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=_interopRequireDefault(r),i=n(8),a=_interopRequireDefault(i),u=n(21),s=_interopRequireDefault(u),l=n(14),c=_interopRequireDefault(l),f=function(e,t,n){var r=(0,s["default"])(t,n),o=r.bounds[1][0]-r.bounds[0][0],i=r.bounds[1][1]-r.bounds[0][1],a=o/2,u=i/2,l=1/a,f=1/u,d=Math.min(l,f),h=d*(r.bounds[0][0]+a),p=d*(r.bounds[0][1]+u);return{code:e,projection:r,transformScale:d,transformation:new c["default"](d,-h,-d,p)}},d=function(e,t,n){return(0,o["default"])({},a["default"],f(e,t,n))};t["default"]=d,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),o=_interopRequireDefault(r),i=n(10),a=_interopRequireDefault(i),u=n(11),s=_interopRequireDefault(u),l=function(e,t){var n=(0,o["default"])(e),r=function(e){return(0,s["default"])(n.forward([e.lon,e.lat]))},i=function(e){var t=n.inverse([e.x,e.y]);return(0,a["default"])(t[1],t[0])};return{project:r,unproject:i,pointScale:function(e,t){return[1,1]},bounds:function(){if(t)return t;var e=r([-90,-180]),n=r([90,180]);return[e,n]}()}};t["default"]=l,e.exports=t["default"]},function(t,n){t.exports=e},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;if(void 0===s)return;return s.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,u=l=void 0}},i=n(2),a=_interopRequireDefault(i),u=n(24),s=_interopRequireDefault(u),l=n(25),c=_interopRequireDefault(l),f=n(26),d=_interopRequireDefault(f),h=n(27),p=_interopRequireDefault(h),v=function(e){function Engine(e){_classCallCheck(this,Engine),console.log("Init Engine"),o(Object.getPrototypeOf(Engine.prototype),"constructor",this).call(this),this._scene=c["default"],this._renderer=(0,d["default"])(e),this._camera=(0,p["default"])(e),this.clock=new s["default"].Clock,this._frustum=new s["default"].Frustum}return _inherits(Engine,e),r(Engine,[{key:"update",value:function(e){this.emit("preRender"),this._renderer.render(this._scene,this._camera),this.emit("postRender")}}]),Engine}(a["default"]);t["default"]=function(e){return new v(e)},e.exports=t["default"]},function(e,n){e.exports=t},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(24),o=_interopRequireDefault(r);t["default"]=function(){var e=new o["default"].Scene;return e.fog=new o["default"].Fog(16777215,1,15e3),e}(),e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(24),o=_interopRequireDefault(r),i=n(25),a=_interopRequireDefault(i);t["default"]=function(e){var t=new o["default"].WebGLRenderer({antialias:!0});t.setClearColor(a["default"].fog.color,1),t.gammaInput=!0,t.gammaOutput=!0,e.appendChild(t.domElement);var n=function(){t.setSize(e.clientWidth,e.clientHeight)};return window.addEventListener("resize",n,!1),n(),t},e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(24),o=_interopRequireDefault(r);t["default"]=function(e){var t=new o["default"].PerspectiveCamera(40,1,1,4e4);t.position.z=400;var n=function(){t.aspect=e.clientWidth/e.clientHeight,t.updateProjectionMatrix()};return window.addEventListener("resize",n,!1),n(),t},e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(29),o=_interopRequireDefault(r),i={Orbit:o["default"]};t["default"]=i,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;if(void 0===s)return;return s.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,u=l=void 0}},i=n(2),a=_interopRequireDefault(i),u=n(24),s=_interopRequireDefault(u),l=n(30),c=_interopRequireDefault(l),f=(0,c["default"])(s["default"]),d=function(e){function Orbit(){_classCallCheck(this,Orbit),o(Object.getPrototypeOf(Orbit.prototype),"constructor",this).call(this)}return _inherits(Orbit,e),r(Orbit,[{key:"_initEvents",value:function(){var e=this;this._controls.addEventListener("start",function(t){e._world.emit("controlsMoveStart",t.target.center)}),this._controls.addEventListener("change",function(t){e._world.emit("controlsMove",t.target.center)}),this._controls.addEventListener("end",function(t){e._world.emit("controlsMoveEnd",t.target.center)})}},{key:"_panTo",value:function(e,t){}},{key:"_panBy",value:function(e,t){}},{key:"_zoomTo",value:function(e,t){}},{key:"_zoomBy",value:function(e,t){}},{key:"_lookAt",value:function(e,t){}},{key:"_lookAtTarget",value:function(){}},{key:"_tiltTo",value:function(e,t){}},{key:"_tiltBy",value:function(e,t){}},{key:"_rotateTo",value:function(e,t){}},{key:"_rotateBy",value:function(e,t){}},{key:"_flyTo",value:function(e,t){}},{key:"update",value:function(){this._controls.update()}},{key:"addTo",value:function(e){return e.addControls(this),this}},{key:"_addToWorld",value:function(e){this._world=e,this._controls=new f(e._engine._camera,e._container),this._controls.keys=!1,this._controls.maxPolarAngle=1.5533,this._initEvents(),this.emit("added")}}]),Orbit}(a["default"]);t["default"]=function(){return new d},e.exports=t["default"]},function(e,t){e.exports=function(e){function OrbitConstraint(t){this.object=t,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25;var n,r,o=this,i=1e-6,a=0,u=0,s=1,l=new e.Vector3,c=!1;this.getPolarAngle=function(){return r},this.getAzimuthalAngle=function(){return n},this.rotateLeft=function(e){u-=e},this.rotateUp=function(e){a-=e},this.panLeft=function(){var t=new e.Vector3;return function(e){var n=this.object.matrix.elements,o=e/Math.cos(r);t.set(n[0],0,n[2]).normalize(),t.multiplyScalar(-o),l.add(t)}}(),this.panUp=function(){var t=new e.Vector3;return function(e){var n=this.object.matrix.elements,o=e/Math.cos(r);t.set(n[8],0,n[10]).normalize(),t.multiplyScalar(-o),l.add(t)}}(),this.pan=function(t,n,r,i){if(o.object instanceof e.PerspectiveCamera){var a=o.object.position,u=a.clone().sub(o.target),s=u.length();
s*=Math.tan(o.object.fov/2*Math.PI/180),o.panLeft(2*t*s/i),o.panUp(2*n*s/i)}else o.object instanceof e.OrthographicCamera?(o.panLeft(t*(o.object.right-o.object.left)/r),o.panUp(n*(o.object.top-o.object.bottom)/i)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(t){o.object instanceof e.PerspectiveCamera?s/=t:o.object instanceof e.OrthographicCamera?(o.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*t)),o.object.updateProjectionMatrix(),c=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(t){o.object instanceof e.PerspectiveCamera?s*=t:o.object instanceof e.OrthographicCamera?(o.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/t)),o.object.updateProjectionMatrix(),c=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var o=new e.Vector3,f=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),d=f.clone().inverse(),h=new e.Vector3,p=new e.Quaternion;return function(){var e=this.object.position;o.copy(e).sub(this.target),o.applyQuaternion(f),n=Math.atan2(o.x,o.z),r=Math.atan2(Math.sqrt(o.x*o.x+o.z*o.z),o.y),n+=u,r+=a,n=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,n)),r=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,r)),r=Math.max(i,Math.min(Math.PI-i,r));var t=o.length()*s;return t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(l),o.x=t*Math.sin(r)*Math.sin(n),o.y=t*Math.cos(r),o.z=t*Math.sin(r)*Math.cos(n),o.applyQuaternion(d),e.copy(this.target).add(o),this.object.lookAt(this.target),this.enableDamping===!0?(u*=1-this.dampingFactor,a*=1-this.dampingFactor):(u=0,a=0),s=1,l.set(0,0,0),c||h.distanceToSquared(this.object.position)>i||8*(1-p.dot(this.object.quaternion))>i?(h.copy(this.object.position),p.copy(this.object.quaternion),c=!1,!0):!1}}()}function OrbitControls(t,n){function pan(e,t){var n=o.domElement===document?o.domElement.body:o.domElement;r.pan(e,t,n.clientWidth,n.clientHeight)}function getAutoRotationAngle(){return 2*Math.PI/60/60*o.autoRotateSpeed}function getZoomScale(){return Math.pow(.95,o.zoomSpeed)}function onMouseDown(e){if(o.enabled!==!1){if(e.preventDefault(),e.button===o.mouseButtons.ORBIT){if(o.enableRotate===!1)return;v=p.ROTATE,i.set(e.clientX,e.clientY)}else if(e.button===o.mouseButtons.ZOOM){if(o.enableZoom===!1)return;v=p.DOLLY,f.set(e.clientX,e.clientY)}else if(e.button===o.mouseButtons.PAN){if(o.enablePan===!1)return;v=p.PAN,s.set(e.clientX,e.clientY)}v!==p.NONE&&(document.addEventListener("mousemove",onMouseMove,!1),document.addEventListener("mouseup",onMouseUp,!1),o.dispatchEvent(m))}}function onMouseMove(e){if(o.enabled!==!1){e.preventDefault();var t=o.domElement===document?o.domElement.body:o.domElement;if(v===p.ROTATE){if(o.enableRotate===!1)return;a.set(e.clientX,e.clientY),u.subVectors(a,i),r.rotateLeft(2*Math.PI*u.x/t.clientWidth*o.rotateSpeed),r.rotateUp(2*Math.PI*u.y/t.clientHeight*o.rotateSpeed),i.copy(a)}else if(v===p.DOLLY){if(o.enableZoom===!1)return;d.set(e.clientX,e.clientY),h.subVectors(d,f),h.y>0?r.dollyIn(getZoomScale()):h.y<0&&r.dollyOut(getZoomScale()),f.copy(d)}else if(v===p.PAN){if(o.enablePan===!1)return;l.set(e.clientX,e.clientY),c.subVectors(l,s),pan(c.x,c.y),s.copy(l)}v!==p.NONE&&o.update()}}function onMouseUp(){o.enabled!==!1&&(document.removeEventListener("mousemove",onMouseMove,!1),document.removeEventListener("mouseup",onMouseUp,!1),o.dispatchEvent(y),v=p.NONE)}function onMouseWheel(e){if(o.enabled!==!1&&o.enableZoom!==!1&&v===p.NONE){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?r.dollyOut(getZoomScale()):0>t&&r.dollyIn(getZoomScale()),o.update(),o.dispatchEvent(m),o.dispatchEvent(y)}}function onKeyDown(e){if(o.enabled!==!1&&o.enableKeys!==!1&&o.enablePan!==!1)switch(e.keyCode){case o.keys.UP:pan(0,o.keyPanSpeed),o.update();break;case o.keys.BOTTOM:pan(0,-o.keyPanSpeed),o.update();break;case o.keys.LEFT:pan(o.keyPanSpeed,0),o.update();break;case o.keys.RIGHT:pan(-o.keyPanSpeed,0),o.update()}}function touchstart(e){if(o.enabled!==!1){switch(e.touches.length){case 1:if(o.enableRotate===!1)return;v=p.TOUCH_ROTATE,i.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(o.enableZoom===!1)return;v=p.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);f.set(0,r);break;case 3:if(o.enablePan===!1)return;v=p.TOUCH_PAN,s.set(e.touches[0].pageX,e.touches[0].pageY);break;default:v=p.NONE}v!==p.NONE&&o.dispatchEvent(m)}}function touchmove(e){if(o.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=o.domElement===document?o.domElement.body:o.domElement;switch(e.touches.length){case 1:if(o.enableRotate===!1)return;if(v!==p.TOUCH_ROTATE)return;a.set(e.touches[0].pageX,e.touches[0].pageY),u.subVectors(a,i),r.rotateLeft(2*Math.PI*u.x/t.clientWidth*o.rotateSpeed),r.rotateUp(2*Math.PI*u.y/t.clientHeight*o.rotateSpeed),i.copy(a),o.update();break;case 2:if(o.enableZoom===!1)return;if(v!==p.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,_=e.touches[0].pageY-e.touches[1].pageY,m=Math.sqrt(n*n+_*_);d.set(0,m),h.subVectors(d,f),h.y>0?r.dollyOut(getZoomScale()):h.y<0&&r.dollyIn(getZoomScale()),f.copy(d),o.update();break;case 3:if(o.enablePan===!1)return;if(v!==p.TOUCH_PAN)return;l.set(e.touches[0].pageX,e.touches[0].pageY),c.subVectors(l,s),pan(c.x,c.y),s.copy(l),o.update();break;default:v=p.NONE}}}function touchend(){o.enabled!==!1&&(o.dispatchEvent(y),v=p.NONE)}function contextmenu(e){e.preventDefault()}var r=new OrbitConstraint(t);this.domElement=void 0!==n?n:document,Object.defineProperty(this,"constraint",{get:function(){return r}}),this.getPolarAngle=function(){return r.getPolarAngle()},this.getAzimuthalAngle=function(){return r.getAzimuthalAngle()},this.enabled=!0,this.center=this.target,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:e.MOUSE.LEFT,ZOOM:e.MOUSE.MIDDLE,PAN:e.MOUSE.RIGHT};var o=this,i=new e.Vector2,a=new e.Vector2,u=new e.Vector2,s=new e.Vector2,l=new e.Vector2,c=new e.Vector2,f=new e.Vector2,d=new e.Vector2,h=new e.Vector2,p={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},v=p.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var _={type:"change"},m={type:"start"},y={type:"end"};this.update=function(){this.autoRotate&&v===p.NONE&&r.rotateLeft(getAutoRotationAngle()),r.update()===!0&&this.dispatchEvent(_)},this.reset=function(){v=p.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(_),this.update()},this.dispose=function(){this.domElement.removeEventListener("contextmenu",contextmenu,!1),this.domElement.removeEventListener("mousedown",onMouseDown,!1),this.domElement.removeEventListener("mousewheel",onMouseWheel,!1),this.domElement.removeEventListener("MozMousePixelScroll",onMouseWheel,!1),this.domElement.removeEventListener("touchstart",touchstart,!1),this.domElement.removeEventListener("touchend",touchend,!1),this.domElement.removeEventListener("touchmove",touchmove,!1),document.removeEventListener("mousemove",onMouseMove,!1),document.removeEventListener("mouseup",onMouseUp,!1),window.removeEventListener("keydown",onKeyDown,!1)},this.domElement.addEventListener("contextmenu",contextmenu,!1),this.domElement.addEventListener("mousedown",onMouseDown,!1),this.domElement.addEventListener("mousewheel",onMouseWheel,!1),this.domElement.addEventListener("MozMousePixelScroll",onMouseWheel,!1),this.domElement.addEventListener("touchstart",touchstart,!1),this.domElement.addEventListener("touchend",touchend,!1),this.domElement.addEventListener("touchmove",touchmove,!1),window.addEventListener("keydown",onKeyDown,!1),this.update()}var t=e.MOUSE;return t||(t={LEFT:0,MIDDLE:1,RIGHT:2}),OrbitControls.prototype=Object.create(e.EventDispatcher.prototype),OrbitControls.prototype.constructor=OrbitControls,Object.defineProperties(OrbitControls.prototype,{object:{get:function(){return this.constraint.object}},target:{get:function(){return this.constraint.target},set:function(e){console.warn("THREE.OrbitControls: target is now immutable. Use target.set() instead."),this.constraint.target.copy(e)}},minDistance:{get:function(){return this.constraint.minDistance},set:function(e){this.constraint.minDistance=e}},maxDistance:{get:function(){return this.constraint.maxDistance},set:function(e){this.constraint.maxDistance=e}},minZoom:{get:function(){return this.constraint.minZoom},set:function(e){this.constraint.minZoom=e}},maxZoom:{get:function(){return this.constraint.maxZoom},set:function(e){this.constraint.maxZoom=e}},minPolarAngle:{get:function(){return this.constraint.minPolarAngle},set:function(e){this.constraint.minPolarAngle=e}},maxPolarAngle:{get:function(){return this.constraint.maxPolarAngle},set:function(e){this.constraint.maxPolarAngle=e}},minAzimuthAngle:{get:function(){return this.constraint.minAzimuthAngle},set:function(e){this.constraint.minAzimuthAngle=e}},maxAzimuthAngle:{get:function(){return this.constraint.maxAzimuthAngle},set:function(e){this.constraint.maxAzimuthAngle=e}},enableDamping:{get:function(){return this.constraint.enableDamping},set:function(e){this.constraint.enableDamping=e}},dampingFactor:{get:function(){return this.constraint.dampingFactor},set:function(e){this.constraint.dampingFactor=e}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=e}}}),OrbitControls}},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;if(void 0===s)return;return s.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,u=l=void 0}},i=n(32),a=_interopRequireDefault(i),u=n(24),s=_interopRequireDefault(u),l=function(e){function EnvironmentLayer(){_classCallCheck(this,EnvironmentLayer),o(Object.getPrototypeOf(EnvironmentLayer.prototype),"constructor",this).call(this),this._initLights(),this._initGrid()}return _inherits(EnvironmentLayer,e),r(EnvironmentLayer,[{key:"_onAdd",value:function(){}},{key:"_initLights",value:function(){var e=new s["default"].DirectionalLight(10066329);e.intesity=.1,e.position.x=100,e.position.y=100,e.position.z=100;var t=new s["default"].DirectionalLight(10066329);t.intesity=.1,t.position.x=-100,t.position.y=100,t.position.z=-100;var n=new s["default"].DirectionalLightHelper(e,10),r=new s["default"].DirectionalLightHelper(t,10);this._layer.add(e),this._layer.add(t),this._layer.add(n),this._layer.add(r)}},{key:"_initGrid",value:function(){var e=4e3,t=100,n=new s["default"].GridHelper(e,t);this._layer.add(n)}}]),EnvironmentLayer}(a["default"]);t["default"]=function(){return new l},e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;if(void 0===s)return;return s.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,u=l=void 0}},i=n(2),a=_interopRequireDefault(i),u=n(24),s=_interopRequireDefault(u),l=n(25),c=(_interopRequireDefault(l),function(e){function Layer(){_classCallCheck(this,Layer),o(Object.getPrototypeOf(Layer.prototype),"constructor",this).call(this),this._layer=new s["default"].Object3D}return _inherits(Layer,e),r(Layer,[{key:"addTo",value:function(e){return e.addLayer(this),this}},{key:"_addToWorld",value:function(e){this._world=e,this._onAdd(e),this.emit("added")}}]),Layer}(a["default"]));t["default"]=c,e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;if(void 0===s)return;return s.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,u=l=void 0}},i=n(32),a=_interopRequireDefault(i),u=n(34),s=_interopRequireDefault(u),l=n(24),c=_interopRequireDefault(l),f=function(e){function GridLayer(){_classCallCheck(this,GridLayer),o(Object.getPrototypeOf(GridLayer.prototype),"constructor",this).call(this),this._minLOD=3,this._maxLOD=18,this._frustum=new c["default"].Frustum}return _inherits(GridLayer,e),r(GridLayer,[{key:"_onAdd",value:function(e){this._initEvents()}},{key:"_initEvents",value:function(){this._world.on("move",function(e){console.log(e)})}},{key:"_updateFrustum",value:function(){var e=this._world.getCamera(),t=new c["default"].Matrix4;t.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromMatrix(e.projectionMatrix),this._frustum.setFromMatrix((new c["default"].Matrix4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))}},{key:"_surfaceInFrustum",value:function(e){return this._frustum.intersectsBox(new c["default"].Box3(new c["default"].Vector3(e.bounds[0],0,e.bounds[3]),new c["default"].Vector3(e.bounds[2],0,e.bounds[1])))}},{key:"_calculateLOD",value:function(){var e=this,t=this._world.getCamera();this._updateFrustum(this._frustum,t);var n=this._checklist;n=[],n.push((0,s["default"])("0",this._world)),n.push((0,s["default"])("1",this._world)),n.push((0,s["default"])("2",this._world)),n.push((0,s["default"])("3",this._world)),this._divide(n),n.forEach(function(t,n){e._surfaceInFrustum(t)&&(console.log(t),e._layer.add(t.mesh))})}},{key:"_divide",value:function(e){for(var t,n,r=0;r!=e.length;)t=e[r],n=t.quadkey,t.length!==this._maxLOD&&this._screenSpaceError(t)?(e.splice(r,1),e.push((0,s["default"])(n+"0",this._world)),e.push((0,s["default"])(n+"1",this._world)),e.push((0,s["default"])(n+"2",this._world)),e.push((0,s["default"])(n+"3",this._world))):r++}},{key:"_screenSpaceError",value:function(e){var t=this._minLOD,n=this._maxLOD,r=this._world.getCamera(),o=3;if(e.quadkey.length>n)return!1;if(e.quadkey.length<t)return!0;if(!this._surfaceInFrustum(e))return!1;var i=new c["default"].Vector3(e.center[0],0,e.center[1]).sub(r.position).length();console.log(e,i);var a=o*e.side/i;return a>1}}]),GridLayer}(a["default"]);t["default"]=function(){return new f},e.exports=t["default"]},function(e,t,n){function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),o=n(10),i=_interopRequireDefault(o),a=n(24),u=_interopRequireDefault(a),s=180/Math.PI,l=new u["default"].TextureLoader;l.setCrossOrigin("");var c=function(){function Surface(e,t){_classCallCheck(this,Surface),this.world=t,this.quadkey=e,this.tile=this._quadkeyToTile(e),this.bounds=this._tileBounds(this.tile),this.center=this._boundsToCenter(this.bounds),this.side=new u["default"].Vector3(this.bounds[0],0,this.bounds[3]).sub(new u["default"].Vector3(this.bounds[0],0,this.bounds[1])).length(),this.mesh=this._createMesh()}return r(Surface,[{key:"_createDebugMesh",value:function(){var e=document.createElement("canvas");e.width=1024,e.height=1024;var t=e.getContext("2d");t.font="Bold 60px Courier",t.fillStyle="rgba(255,0,0,1)",t.fillText(this.quadkey,100,530);var n=new u["default"].Texture(e);n.magFilter=u["default"].LinearFilter,n.minFilter=u["default"].LinearMipMapLinearFilter,n.anisotropy=4,n.needsUpdate=!0;var r=new u["default"].MeshBasicMaterial({map:n,transparent:!0}),o=new u["default"].PlaneGeometry(this.side,this.side,1),i=new u["default"].Mesh(o,r);i.rotation.x=-90*Math.PI/180,i.position.y=.1,this.mesh.add(i)}},{key:"_createMesh",value:function(){var e=this,t=new u["default"].Object3D,n=new u["default"].PlaneGeometry(this.side,this.side,1),r=String.fromCharCode(97+Math.floor(26*Math.random())),o="http://"+r+".basemaps.cartocdn.com/light_nolabels/";return l.load(o+this.tile[2]+"/"+this.tile[0]+"/"+this.tile[1]+"@2x.png",function(r){console.log("Loaded"),r.magFilter=u["default"].LinearFilter,r.minFilter=u["default"].LinearMipMapLinearFilter,r.anisotropy=4,r.needsUpdate=!0;var o=new u["default"].MeshBasicMaterial({map:r}),i=new u["default"].Mesh(n,o);i.rotation.x=-90*Math.PI/180,setTimeout(function(){t.add(i)},2e3),t.position.x=e.center[0],t.position.z=e.center[1];var a=new u["default"].BoxHelper(i);t.add(a),e._createDebugMesh()}),t}},{key:"_quadkeyToTile",value:function(e){for(var t=0,n=0,r=e.length,o=r;o>0;o--){var i=1<<o-1,a=+e[r-o];1===a&&(t|=i),2===a&&(n|=i),3===a&&(t|=i,n|=i)}return[t,n,r]}},{key:"_boundsToCenter",value:function(e){var t=e[0]+(e[2]-e[0])/2,n=e[1]+(e[3]-e[1])/2;return[t,n]}},{key:"_tileBounds",value:function(e){var t=this._tileBoundsWGS84(e),n=this.world.latLonToPoint((0,i["default"])(t[1],t[0])),r=this.world.latLonToPoint((0,i["default"])(t[3],t[2]));return[n.x,n.y,r.x,r.y]}},{key:"_tileBoundsWGS84",value:function(e){var t=this._tile2lon(e[0]+1,e[2]),n=this._tile2lon(e[0],e[2]),r=this._tile2lat(e[1]+1,e[2]),o=this._tile2lat(e[1],e[2]);return[n,r,t,o]}},{key:"_tile2lon",value:function(e,t){return e/Math.pow(2,t)*360-180}},{key:"_tile2lat",value:function(e,t){var n=Math.PI-2*Math.PI*e/Math.pow(2,t);return s*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}}]),Surface}();t["default"]=function(e,t){return new c(e,t)},e.exports=t["default"]}])});
//# sourceMappingURL=vizicities.min.js.map
